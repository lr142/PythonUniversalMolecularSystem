include "system.in.init"
boundary p p p
read_data "system.data"
include "system.in.settings"

thermo_style custom step temp pe evdwl ecoul epair ebond eangle edihed eimp press lx density

variable T equal 300
variable P equal 100000
velocity all create $T 17236978

#minimize 0 1e-5 10 100

timestep 0.001
fix  fxnvt all nvt temp $T $T 100
thermo 100
run  3000
unfix fxnvt
write_data relaxed.data

reset_timestep 0
timestep 1
fix  fxnpt all npt temp $T $T 100.0 iso $P $P 1000

# dump every 1 ps
dump d1 all custom 10000 system.lammpstrj id mol type x y z vx vy vz ix iy iz


variable    epoch loop 50
label       loop
print       "EPOCH = ${epoch}"
run         100000  # 100 ps each time
write_restart  system.${epoch}.restart
if          "${epoch} >= 50" then "jump SELF break"
next        epoch
jump        SELF loop
label       break

write_data final.data